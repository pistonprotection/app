# PistonProtection Helm Chart Values
# Default values for pistonprotection deployment

# Global settings
global:
  # Image pull secrets
  imagePullSecrets: []
  # Storage class for persistent volumes
  storageClass: ""

# Gateway service configuration
gateway:
  enabled: true
  replicaCount: 2
  image:
    repository: pistonprotection/gateway
    tag: ""  # Defaults to appVersion
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
    grpcPort: 9090
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilization: 80
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Worker service configuration (eBPF/XDP filtering)
worker:
  enabled: true
  # DaemonSet by default for network-level filtering
  kind: DaemonSet
  image:
    repository: pistonprotection/worker
    tag: ""
    pullPolicy: IfNotPresent
  # Host network is required for XDP
  hostNetwork: true
  dnsPolicy: ClusterFirstWithHostNet
  # Privileged mode required for eBPF
  securityContext:
    privileged: true
    capabilities:
      add:
        - NET_ADMIN
        - SYS_ADMIN
        - BPF
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  # Node selector for worker nodes
  nodeSelector:
    pistonprotection.io/worker: "true"
  tolerations:
    - key: "pistonprotection.io/worker"
      operator: "Exists"
      effect: "NoSchedule"
  # Volumes for eBPF maps
  volumes:
    - name: bpf-maps
      hostPath:
        path: /sys/fs/bpf
        type: DirectoryOrCreate
  volumeMounts:
    - name: bpf-maps
      mountPath: /sys/fs/bpf

# Config Manager service
configMgr:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/config-mgr
    tag: ""
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Metrics collector service
metrics:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/metrics
    tag: ""
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Kubernetes operator
operator:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/operator
    tag: ""
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  # Install CRDs
  installCRDs: true

# Frontend dashboard
frontend:
  enabled: true
  replicaCount: 2
  image:
    repository: pistonprotection/frontend
    tag: ""
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 3000
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: pistonprotection.local
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: gateway
  tls: []
  #  - secretName: pistonprotection-tls
  #    hosts:
  #      - pistonprotection.local

# PostgreSQL configuration
postgresql:
  enabled: true
  auth:
    postgresPassword: ""
    username: pistonprotection
    password: ""
    database: pistonprotection
  primary:
    persistence:
      enabled: true
      size: 10Gi
  # External PostgreSQL (when postgresql.enabled=false)
  external:
    host: ""
    port: 5432
    database: pistonprotection
    username: ""
    password: ""
    existingSecret: ""

# Redis configuration
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    password: ""
  master:
    persistence:
      enabled: true
      size: 1Gi
  # External Redis (when redis.enabled=false)
  external:
    host: ""
    port: 6379
    password: ""
    existingSecret: ""

# Observability
observability:
  # Prometheus metrics
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: false
      namespace: ""
      interval: 30s
      scrapeTimeout: 10s
  # Grafana dashboards
  grafana:
    enabled: false
    dashboards:
      enabled: true
  # Loki logging
  loki:
    enabled: false

# Service accounts
serviceAccount:
  create: true
  annotations: {}
  name: ""

# RBAC configuration
rbac:
  create: true

# Pod security policies
podSecurityPolicy:
  enabled: false

# Network policies
networkPolicy:
  enabled: false

# Protection settings (defaults)
protection:
  # Default protection level (1-5)
  defaultLevel: 3
  # Default rate limits
  rateLimit:
    ppsPerIp: 1000
    burst: 2000
    globalPps: 1000000
  # Protocol validation
  protocols:
    minecraft:
      enabled: true
      minVersion: 47
      maxVersion: 769
    quic:
      enabled: true
    synCookies:
      enabled: true

# Extra environment variables
extraEnv: []
  # - name: MY_VAR
  #   value: "my-value"

# Extra volumes
extraVolumes: []

# Extra volume mounts
extraVolumeMounts: []
