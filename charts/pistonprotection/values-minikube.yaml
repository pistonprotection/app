# =============================================================================
# PistonProtection - Minikube Development Values
# =============================================================================
# Optimized for local development and testing on minikube
#
# Usage:
#   helm install pp ./charts/pistonprotection -f ./charts/pistonprotection/values-minikube.yaml
#
# =============================================================================

# Global settings optimized for local development
global:
  imagePullSecrets: []
  storageClass: standard
  environment: development
  logLevel: debug

# Override image pull policy for local development
# Using IfNotPresent to allow pulling from minikube's docker daemon
# Change to Never after running: eval $(minikube docker-env) && docker build ...

# =============================================================================
# Gateway Service - Single replica for local dev
# =============================================================================
gateway:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/gateway
    tag: dev
    pullPolicy: IfNotPresent
  service:
    type: NodePort
    port: 8080
    grpcPort: 9090
    metricsPort: 9091
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    enabled: false
  pdb:
    enabled: false
  podSecurityContext:
    runAsNonRoot: false
    runAsUser: 0
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop: []
  config:
    connectionPoolSize: 50
    requestTimeout: 30
    maxConcurrentConnections: 1000
    requestLogging: true
    cors:
      enabled: true
      allowOrigins:
        - "*"
      allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      allowHeaders:
        - "*"
      maxAge: 86400

# =============================================================================
# Worker Service - Minimal for local testing
# =============================================================================
worker:
  enabled: true
  kind: Deployment
  replicaCount: 1
  image:
    repository: pistonprotection/worker
    tag: dev
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
    metricsPort: 9090
  # Disable host network for minikube
  hostNetwork: false
  dnsPolicy: ClusterFirst
  # Less restrictive security for local dev
  securityContext:
    privileged: false
    capabilities:
      add: []
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  # Remove node selector for local dev
  nodeSelector: {}
  tolerations: []
  # Simplified volumes for local dev (no eBPF)
  volumes: []
  volumeMounts: []
  config:
    networkInterface: eth0
    xdpMode: generic
    perCpuMaps: false
    mapSize: 1024
    statsInterval: 30

# =============================================================================
# Config Manager Service
# =============================================================================
configMgr:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/config-mgr
    tag: dev
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  autoscaling:
    enabled: false
  pdb:
    enabled: false
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
  config:
    syncInterval: 10
    enableValidation: true
    cacheTtl: 60

# =============================================================================
# Metrics Service
# =============================================================================
metrics:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/metrics
    tag: dev
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  autoscaling:
    enabled: false
  pdb:
    enabled: false
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
  config:
    aggregationInterval: 30
    retentionPeriod: 1h
    perIpMetrics: true
    maxTrackedIps: 1000

# =============================================================================
# Auth Service
# =============================================================================
auth:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/auth
    tag: dev
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  autoscaling:
    enabled: false
  pdb:
    enabled: false
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
  config:
    jwtExpiration: 24h
    refreshTokenExpiration: 7d
    passwordMinLength: 8
    mfaEnabled: false
    sessionTimeout: 120
    maxLoginAttempts: 10
    lockoutDuration: 5
    oauth:
      enabled: false
      providers: []
    apiKeys:
      enabled: true
      prefix: "pp_dev_"
      defaultExpiration: 365

# =============================================================================
# Kubernetes Operator
# =============================================================================
operator:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/operator
    tag: dev
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  installCRDs: true
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
  config:
    leaderElection: false
    reconcileInterval: 10
    watchAllNamespaces: false
    watchNamespaces: []

# =============================================================================
# Frontend Dashboard
# =============================================================================
frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: pistonprotection/frontend
    tag: dev
    pullPolicy: IfNotPresent
  service:
    type: NodePort
    port: 3000
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  autoscaling:
    enabled: false
  pdb:
    enabled: false
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
  config:
    apiUrl: ""
    enableRealtime: true
    refreshInterval: 10
    defaultTheme: system

# =============================================================================
# Ingress Configuration
# =============================================================================
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
  hosts:
    - host: pistonprotection.local
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: gateway
        - path: /auth
          pathType: Prefix
          service: auth
  tls: []

# =============================================================================
# PostgreSQL - Minimal for local dev
# =============================================================================
postgresql:
  enabled: true
  auth:
    postgresPassword: devpassword123
    username: pistonprotection
    password: devpassword123
    database: pistonprotection
  primary:
    persistence:
      enabled: true
      size: 1Gi
      storageClass: standard
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

# =============================================================================
# Redis - Minimal standalone for local dev
# =============================================================================
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
    password: ""
  master:
    persistence:
      enabled: true
      size: 500Mi
      storageClass: standard
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

# =============================================================================
# Observability - Disabled for local dev
# =============================================================================
observability:
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: false
    rules:
      enabled: false
  grafana:
    enabled: false
  loki:
    enabled: false
  tracing:
    enabled: false

# =============================================================================
# GeoIP - Disabled for local dev
# =============================================================================
geoip:
  enabled: false

# =============================================================================
# Stripe - Disabled for local dev
# =============================================================================
stripe:
  enabled: false

# =============================================================================
# Service Account
# =============================================================================
serviceAccount:
  create: true
  annotations: {}
  name: ""

# =============================================================================
# RBAC
# =============================================================================
rbac:
  create: true

# =============================================================================
# Network Policies - Disabled for local dev
# =============================================================================
networkPolicy:
  enabled: false

# =============================================================================
# Protection Settings - Relaxed for local testing
# =============================================================================
protection:
  defaultLevel: 2
  rateLimit:
    ppsPerIp: 10000
    burst: 50000
    globalPps: 1000000
    connectionsPerIp: 1000
    newConnectionsPerSecond: 500
  protocols:
    minecraft:
      enabled: true
      minVersion: 47
      maxVersion: 769
      packetInspection: true
      maxPacketSize: 32767
    quic:
      enabled: false
    synCookies:
      enabled: false
    tcp:
      enabled: true
      maxSegmentSize: 1460
      connectionTracking: false
    udp:
      enabled: true
      timeout: 60
  challenge:
    jsChallenge: false
    cookieLifetime: 3600
    difficulty: 3
  lists:
    blacklistEnabled: true
    whitelistEnabled: true
    autoBlacklistThreshold: 100
    autoBlacklistDuration: 300

# =============================================================================
# ClickHouse - Minimal for local dev
# =============================================================================
clickhouse:
  enabled: true
  architecture: standalone
  image:
    repository: clickhouse/clickhouse-server
    tag: "24.3"
    pullPolicy: IfNotPresent
  auth:
    username: default
    password: devpassword123
  database: pistonprotection
  persistence:
    enabled: true
    size: 2Gi
    storageClass: standard
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi
  config:
    maxServerMemoryUsage: 500000000
    maxConcurrentQueries: 20
    maxMemoryUsage: 400000000
    backgroundPoolSize: 4
    logLevel: debug
  retention:
    rawEvents: 1
    aggregatedData: 7

# =============================================================================
# Secrets
# =============================================================================
secrets:
  externalSecrets:
    enabled: false
  jwtSigningKey: "dev-jwt-signing-key-not-for-production-use"
  encryptionKey: "dev-encryption-key-not-for-production"

# =============================================================================
# Extra Configuration
# =============================================================================
extraEnv:
  - name: DEVELOPMENT_MODE
    value: "true"
  - name: LOG_LEVEL
    value: "debug"

priorityClassName: ""
topologySpreadConstraints: []
