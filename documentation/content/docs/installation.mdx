---
title: Installation
description: Deploy PistonProtection to your Kubernetes cluster
---

# Installation Guide

This guide covers deploying PistonProtection to a Kubernetes cluster using Helm.

## Prerequisites

- Kubernetes 1.28+ cluster
- Helm 3.10+
- Linux kernel 5.10+ (for eBPF/XDP support)
- Cilium CNI (recommended for enhanced network policies)

## System Requirements

### Worker Nodes

Worker nodes that will run eBPF filters require:

- Linux kernel 5.10+ with BPF JIT enabled
- Network interface with XDP support (native mode preferred)
- CAP_BPF, CAP_NET_ADMIN, CAP_SYS_ADMIN capabilities

### Control Plane

- 2 CPU cores minimum
- 4GB RAM minimum
- 20GB storage for metrics and logs

## Installation Steps

### 1. Add the Helm Repository

```bash
helm repo add pistonprotection https://charts.pistonprotection.io
helm repo update
```

### 2. Create Namespace

```bash
kubectl create namespace pistonprotection
```

### 3. Create Secrets

Create secrets for database and API keys:

```bash
kubectl create secret generic pistonprotection-secrets \
  --namespace pistonprotection \
  --from-literal=postgres-password=$(openssl rand -base64 32) \
  --from-literal=redis-password=$(openssl rand -base64 32) \
  --from-literal=jwt-signing-key=$(openssl rand -base64 64) \
  --from-literal=stripe-api-key=sk_live_xxx \
  --from-literal=stripe-webhook-secret=whsec_xxx
```

### 4. Install PistonProtection

```bash
helm install pistonprotection pistonprotection/pistonprotection \
  --namespace pistonprotection \
  --values values.yaml
```

### 5. Label Worker Nodes

Label nodes that should run eBPF filters:

```bash
kubectl label nodes <node-name> pistonprotection.io/worker=true
```

## Configuration Options

### Minimal Installation

```yaml
# values-minimal.yaml
global:
  environment: development

gateway:
  replicaCount: 1

worker:
  enabled: true
  config:
    xdpMode: generic

postgresql:
  enabled: true
  primary:
    persistence:
      size: 5Gi

redis:
  enabled: true
  master:
    persistence:
      size: 1Gi

observability:
  prometheus:
    enabled: true
  grafana:
    enabled: false
```

### Production Installation

```yaml
# values-production.yaml
global:
  environment: production

gateway:
  replicaCount: 3
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10

worker:
  enabled: true
  config:
    xdpMode: native
    perCpuMaps: true
    mapSize: 1000000

auth:
  replicaCount: 3
  autoscaling:
    enabled: true

postgresql:
  enabled: false
  external:
    host: your-postgres-host
    database: pistonprotection
    sslMode: require

redis:
  enabled: false
  external:
    host: your-redis-host
    tls: true

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: protection.example.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
  tls:
    - secretName: pistonprotection-tls
      hosts:
        - protection.example.com

networkPolicy:
  enabled: true
  type: cilium

observability:
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: true
  grafana:
    enabled: true
    dashboards:
      enabled: true
  loki:
    enabled: true
```

## Verify Installation

```bash
# Check pod status
kubectl get pods -n pistonprotection

# Check services
kubectl get svc -n pistonprotection

# View worker logs
kubectl logs -n pistonprotection -l app.kubernetes.io/component=worker

# Check eBPF program status
kubectl exec -n pistonprotection -it <worker-pod> -- bpftool prog list
```

## Upgrading

```bash
helm repo update
helm upgrade pistonprotection pistonprotection/pistonprotection \
  --namespace pistonprotection \
  --values values.yaml
```

## Uninstalling

```bash
helm uninstall pistonprotection --namespace pistonprotection
kubectl delete namespace pistonprotection
```
